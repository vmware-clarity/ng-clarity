<div
  role="row"
  [id]="id"
  class="datagrid-row-master datagrid-row-flex"
  [clrExpandableAnimation]="expandAnimationTrigger"
  (mousedown)="clearRanges($event)"
  (click)="selectRow(!selected, $event)"
  [class.datagrid-row-clickable]="selection.rowSelectionMode"
  [class.datagrid-row-detail-open]="detailService.isRowOpen(item)"
>
  <div class="datagrid-row-sticky">
    <!-- Sticky elements here -->
    <ng-container #stickyCells>
      @if (selection.selectionType === SELECTION_TYPE.Multi) {
      <div
        class="datagrid-select datagrid-fixed-column datagrid-cell"
        [ngClass]="{ 'clr-form-control-disabled': !clrDgSelectable }"
        role="gridcell"
      >
        <div class="clr-checkbox-wrapper">
          <input
            tabindex="-1"
            type="checkbox"
            [ngModel]="selected"
            (ngModelChange)="toggle($event)"
            [id]="checkboxId"
            [disabled]="clrDgSelectable ? null : true"
            [attr.aria-disabled]="clrDgSelectable ? null : true"
          />
          <!-- Usage of class clr-col-null here prevents clr-col-* classes from being added when a datagrid is wrapped inside clrForm -->
          <label [for]="checkboxId" class="clr-control-label clr-col-null" (click)="clearRanges($event)">
            <span class="clr-sr-only">{{clrDgRowSelectionLabel || commonStrings.keys.select}}</span>
          </label>
        </div>
      </div>
      } @if (selection.selectionType === SELECTION_TYPE.Single) {
      <div
        class="datagrid-select datagrid-fixed-column datagrid-cell"
        [ngClass]="{ 'clr-form-control-disabled': !clrDgSelectable }"
        role="gridcell"
      >
        <clr-radio-wrapper>
          <input
            tabindex="-1"
            type="radio"
            clrRadio
            clrDgSingleSelectionRadio
            [clrDgIdentityFn]="identifyBy"
            [id]="radioId"
            [name]="selection.id + '-radio'"
            [value]="item"
            [(ngModel)]="selection.currentSingle"
            [disabled]="clrDgSelectable ? null : true"
            [attr.aria-disabled]="clrDgSelectable ? null : true"
          />
          <label class="clr-control-label clr-col-null" [for]="radioId">
            <span class="clr-sr-only">{{ clrDgRowSelectionLabel || commonStrings.keys.select }}</span>
          </label>
        </clr-radio-wrapper>
      </div>
      } @if (rowActionService.hasActionableRow) {
      <div class="datagrid-row-actions datagrid-fixed-column datagrid-cell" role="gridcell">
        <ng-content select="clr-dg-action-overflow"></ng-content>
      </div>
      } @if (globalExpandable.hasExpandableRow) {
      <div class="datagrid-expandable-caret datagrid-fixed-column datagrid-cell" role="gridcell">
        @if (expand.expandable) { @if (!expand.loading) {
        <button
          tabindex="-1"
          (click)="toggleExpand()"
          type="button"
          class="datagrid-expandable-caret-button"
          [attr.aria-expanded]="expand.expanded"
          [attr.aria-label]="expand.expanded ? clrDgDetailCloseLabel : clrDgDetailOpenLabel"
          [attr.aria-controls]="expand.hasExpandTemplate && !expand.expanded ? null : expandableId"
        >
          <cds-icon
            shape="angle"
            class="datagrid-expandable-caret-icon"
            [direction]="expand.expanded ? 'down' : 'right'"
            [attr.title]="expand.expanded ? commonStrings.keys.collapse : commonStrings.keys.expand"
          ></cds-icon>
        </button>
        } @if (expand.loading) {
        <clr-spinner clrSmall>{{ commonStrings.keys.loading }}</clr-spinner>
        } }
      </div>
      } @if (detailService.enabled) {
      <div class="datagrid-detail-caret datagrid-fixed-column datagrid-cell" role="gridcell">
        @if (!detailHidden) {
        <button
          tabindex="-1"
          (click)="detailService.toggle(item, detailButton)"
          type="button"
          #detailButton
          class="datagrid-detail-caret-button"
          [disabled]="detailDisabled"
          [class.is-open]="detailService.isRowOpen(item)"
          [attr.aria-label]="detailService.isRowOpen(item) ? clrDgDetailCloseLabel : clrDgDetailOpenLabel"
          [attr.aria-expanded]="detailService.isRowOpen(item)"
          [attr.aria-controls]="detailService.id"
          aria-haspopup="dialog"
        >
          <cds-icon
            shape="angle-double"
            [direction]="detailService.isRowOpen(item) ? 'left' : 'right'"
            class="datagrid-detail-caret-icon"
            [attr.title]="detailService.isRowOpen(item) ? commonStrings.keys.close: commonStrings.keys.open"
          ></cds-icon>
        </button>
        }
      </div>
      }
    </ng-container>
    <!-- placeholder for projecting other sticky cells as pinned-->
  </div>
  <div class="datagrid-row-scrollable" [ngClass]="{'is-replaced': replaced && expanded}">
    <div class="datagrid-scrolling-cells">
      <ng-content select="clr-dg-cell"></ng-content>
      <ng-container #scrollableCells></ng-container>
    </div>
    <!-- details here when replace, re-visit when sticky container is used for pinned cells -->
    @if (replaced && !expand.loading) {
    <ng-template [ngTemplateOutlet]="detail"></ng-template>
    } @if (!replaced && !expand.loading) {
    <ng-template [ngTemplateOutlet]="detail"></ng-template>
    }
  </div>
</div>
<!--
We need the "project into template" hacks because we need this in 2 different places
depending on whether the details replace the row or not.
-->
<ng-template #detail>
  <ng-content select="clr-dg-row-detail"></ng-content>
</ng-template>

<ng-container #calculatedCells></ng-container>

<ng-template #fixedCellTemplate>
  <div class="datagrid-fixed-column datagrid-cell" role="gridcell"></div>
</ng-template>
